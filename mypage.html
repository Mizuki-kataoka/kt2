<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>マイページ</title>
  </head>
  <body>
    <header>
      <h1>👤 マイページ</h1>
      <p>あなたの情報と所属グループの一覧を確認できます。</p>
    </header>

    <main>
      <section>
        <h2>アカウント情報</h2>

        <div style="display: flex; align-items: center; margin-bottom: 20px;">
          <div
            style="
              width: 50px;
              height: 50px;
              border-radius: 50%; /* 円形 */
              background-color: #007bff; /* アイコンカラー（青を仮定） */
              color: white;
              display: flex;
              justify-content: center;
              align-items: center;
              font-size: 20px;
              margin-right: 15px;
            "
          >
            A
          </div>
          <div>
            <p><strong>ユーザー名:</strong> 山田太郎</p>
            <p><strong>メールアドレス:</strong> yamada.taro@example.com</p>
            <p><strong>アイコンカラー:</strong> #007bff (青)</p>
          </div>
        </div>
      </section>

      <hr />

      <section>
        <h2>所属グループ一覧</h2>
        <table border="1" style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr>
              <th style="padding: 8px;">授業名</th>
              <th style="padding: 8px;">グループ名</th>
              <th style="padding: 8px;">貢献度 (仮)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="padding: 8px;">情報処理基礎</td>
              <td style="padding: 8px;">
                <a href="kt2.html?group=teamA">チームA</a>
              </td>
              <td style="padding: 8px;" id="contribution-teamA">85%</td>
            </tr>
            <tr>
              <td style="padding: 8px;">経済学入門</td>
              <td style="padding: 8px;">
                <a href="kt2.html?group=group3">第3グループ</a>
              </td>
              <td style="padding: 8px;" id="contribution-group3">70%</td>
            </tr>
            <tr>
              <td style="padding: 8px;">応用数学</td>
              <td style="padding: 8px;">
                <a href="kt2.html?group=mathLab">数理研</a>
              </td>
              <td style="padding: 8px;" id="contribution-mathLab">92%</td>
            </tr>
            </tbody>
        </table>
        <br />
        <p>※ 貢献度は連携後に正確な値が表示されます。</p>
      </section>

      <hr />

      <section>
        <h2>新規グループ登録</h2>
        <p>
          <a href="group.sentaku.html">
            <button style="padding: 10px 20px; font-size: 16px;">
              ➕ 新しいグループを登録する
            </button>
          </a>
        </p>
      </section>
    </main>

    <footer>
      <p style="margin-top: 50px;">
        &copy; 2025 あなたの頑張り見える化します
      </p>
    </footer>

    <script>
        // URLのクエリパラメータから値を取得する関数
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(location.search);
            // 結果がなければ空文字列、あればデコードした値を返す
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        };

        // kt2.htmlから戻ったときに貢献度を更新する関数
        function updateContributionFromURL() {
            const score = getUrlParameter('score');
            const groupId = getUrlParameter('group'); // kt2.htmlから渡されるグループID

            if (score !== '' && groupId !== '') {
                // グループIDに対応する貢献度表示セルを取得
                const contributionCell = document.getElementById(`contribution-${groupId}`);

                if (contributionCell) {
                    contributionCell.innerText = `${score}%`;
                    
                    // スコアが反映された後、URLからパラメータを削除して履歴を置き換える
                    // これにより、マイページをリロードしても古いスコアが適用されるのを防ぎます
                    history.replaceState(null, document.title, "mypage.html");
                }
            }
        }

        // ページ読み込み時に更新処理を実行
        updateContributionFromURL();
    </script>
  </body>
</html>
