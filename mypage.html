<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>ãƒã‚¤ãƒšãƒ¼ã‚¸</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap" rel="stylesheet">
  </head>
  <body>
    <header>
      <h1>ğŸ‘¤ ãƒã‚¤ãƒšãƒ¼ã‚¸</h1>
      <p>ã‚ãªãŸã®æƒ…å ±ã¨æ‰€å±ã‚°ãƒ«ãƒ¼ãƒ—ã®ä¸€è¦§ã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>
    </header>

    <main>
      <!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ± -->
      <section>
        <h2>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±</h2>
        <div style="display: flex; align-items: center; margin-bottom: 20px;">
          <div
            id="account-icon"
            style="
              width: 50px;
              height: 50px;
              border-radius: 50%;
              background-color: #ccc; /* åˆæœŸè‰² */
              color: white;
              display: flex;
              justify-content: center;
              align-items: center;
              font-size: 20px;
              margin-right: 15px;
            "
          >
            <span id="account-initial">?</span>
          </div>
          <div>
            <p><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼å:</strong> <span id="account-name"></span></p>
            <p><strong>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</strong> <span id="account-email"></span></p>
            <p><strong>åŒºåˆ†:</strong> <span id="account-role"></span></p>
            <p><strong>ã‚¢ã‚¤ã‚³ãƒ³ã‚«ãƒ©ãƒ¼:</strong> <span id="account-color"></span></p>
          </div>
        </div>
      </section>

      <hr />

      <!-- æ‰€å±ã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§ -->
      <section>
        <h2>æ‰€å±ã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§</h2>
        <table border="1" style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr>
              <th style="padding: 8px;">æˆæ¥­å</th>
              <th style="padding: 8px;">ã‚°ãƒ«ãƒ¼ãƒ—å</th>
              <th style="padding: 8px;">è²¢çŒ®åº¦ (ä»®)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="padding: 8px;">æƒ…å ±å‡¦ç†åŸºç¤</td>
              <td style="padding: 8px;">
                <a href="kt2.html?group=teamA">ãƒãƒ¼ãƒ A</a>
              </td>
              <td style="padding: 8px;" id="contribution-teamA">85%</td>
            </tr>
            <tr>
              <td style="padding: 8px;">çµŒæ¸ˆå­¦å…¥é–€</td>
              <td style="padding: 8px;">
                <a href="kt2.html?group=group3">ç¬¬3ã‚°ãƒ«ãƒ¼ãƒ—</a>
              </td>
              <td style="padding: 8px;" id="contribution-group3">70%</td>
            </tr>
            <tr>
              <td style="padding: 8px;">å¿œç”¨æ•°å­¦</td>
              <td style="padding: 8px;">
                <a href="kt2.html?group=mathLab">æ•°ç†ç ”</a>
              </td>
              <td style="padding: 8px;" id="contribution-mathLab">92%</td>
            </tr>
          </tbody>
        </table>
        <br />
        <p>â€» è²¢çŒ®åº¦ã¯é€£æºå¾Œã«æ­£ç¢ºãªå€¤ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
      </section>

      <hr />

      <!-- æ–°è¦ã‚°ãƒ«ãƒ¼ãƒ—ç™»éŒ² -->
      <section>
        <h2>æ–°è¦ã‚°ãƒ«ãƒ¼ãƒ—ç™»éŒ²</h2>
        <p>
          <a href="group.sentaku.html">
            <button style="padding: 10px 20px; font-size: 16px;">
              â• æ–°ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç™»éŒ²ã™ã‚‹
            </button>
          </a>
        </p>
      </section>
    </main>

    <footer>
      <p style="margin-top: 50px;">
        &copy; 2025 ã‚ãªãŸã®é ‘å¼µã‚Šè¦‹ãˆã‚‹åŒ–ã—ã¾ã™
      </p>
    </footer>

    <!-- Firestoreã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾— -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
      import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyB2TFRxULrSZ9MWl-UkArF4bx22UXP3a-Q",
        authDomain: "isd-kt2.firebaseapp.com",
        projectId: "isd-kt2",
        storageBucket: "isd-kt2.appspot.com",
        messagingSenderId: "302204280336",
        appId: "1:302204280336:web:c9501e1a34618e9f46b495"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰uidã‚’å–å¾—
      function getUrlParameter(name) {
        const regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
        const results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1]);
      }

      const uid = getUrlParameter("uid");

      window.addEventListener("DOMContentLoaded", async () => {
        if (uid) {
          const userRef = doc(db, "users", uid);
          const userSnap = await getDoc(userRef);

          if (userSnap.exists()) {
            const userData = userSnap.data();

            // ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã‚’åæ˜ 
            document.getElementById("account-name").innerText = userData.name;
            document.getElementById("account-email").innerText = userData.email;
            document.getElementById("account-role").innerText = userData.role;
            document.getElementById("account-color").innerText = userData.iconColor;

            // ã‚¢ã‚¤ã‚³ãƒ³ã‚«ãƒ©ãƒ¼ã‚’åæ˜ 
            const iconDiv = document.getElementById("account-icon");
            iconDiv.style.backgroundColor = userData.iconColor;

            // åå‰ã®é ­æ–‡å­—ã‚’ã‚¢ã‚¤ã‚³ãƒ³ã«è¡¨ç¤º
            document.getElementById("account-initial").innerText = userData.name.charAt(0);
          }
        }
      });
    </script>

    <!-- kt2.htmlã‹ã‚‰æˆ»ã£ãŸã¨ãã«è²¢çŒ®åº¦ã‚’æ›´æ–° -->
    <script>
      function getUrlParameter(name) {
        const regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
        const results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1]);
      }

      function updateContributionFromURL() {
        const score = getUrlParameter('score');
        const groupId = getUrlParameter('group');

        if (score !== '' && groupId !== '') {
          const contributionCell = document.getElementById(`contribution-${groupId}`);
          if (contributionCell) {
            contributionCell.innerText = `${score}%`;
            history.replaceState(null, document.title, "mypage.html");
          }
        }
      }

      updateContributionFromURL();
    </script>
  </body>
</html>
